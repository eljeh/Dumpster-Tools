---
import Layout from '../layouts/Layout.astro';
---

<style is:inline>

  .wrapper {
    margin: 1em auto;
    justify-content: center;
    display: flex;
    flex-direction: column;
    max-width: 120ch;
  }

</style>

<Layout title='BOT API'>
  <h2 class='my-8 text-2xl text-center'>Send Message</h2>
  <div class='wrapper'>
    <form class='w-full flex flex-col item-center'>
      <div class='flex items-center justify-center mb-6'>
        <div class=''>
          <label
            for='messageInput'
            class='block font-bold md:text-right mb-1 md:mb-0 pr-4'
            for='inline-full-name'
          >
            message Input
          </label>
        </div>
        <div class=''>
          <input
            id='messageInput'
            class='border rounded w-full py-2 px-3 mb-2 leading-tight'
          />
        </div>
      </div>

      <div class='flex items-center justify-center mb-6'>
        <div class=''>
          <button
            class='shadow focus:shadow-outline focus:outline-none font-bold py-2 px-4 rounded'
            type='button'
          >
            Send Message
          </button>
        </div>
      </div>
    </form>

    <div>
      <script>
        const heresMYAuth = 'WhalleyBotAPI_F935H3ucUJRv7g=='; //'WhalleyBotAPI_rtTECwgxKLKy9Q==',
        const sendButton = document.querySelector('button');

        sendButton.addEventListener('click', async () => {
          const message = document.getElementById('messageInput');

          if (message.value) {
            try {
              // Encode the message
              const encodedMessage = encodeURIComponent(message.value);

              const response = await fetch(
                `https://api.whalleybot.com/bot/7ac35e92/GlobalMessage/Send?message=${encodedMessage}`,
                {
                  method: 'POST',
                  headers: {
                    Accept: '*/*',
                    Authorization: heresMYAuth,
                  },
                },
              );
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              const data = await response.json();
              console.log('Message: ', data);
            } catch (error) {
              console.error('Error sending message: ', error);
            }
          } else {
            console.error('Please input a message to send.');
          }
        });
      </script>
    </div>
  </div>
</Layout>
